name: Trigger Spacelift

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  trigger-spacelift:
    runs-on: ubuntu-latest
    steps:
      - name: Install spacectl
        uses: spacelift-io/setup-spacectl@main
      
      - name: Trigger run
        run: |
          spacectl profile login --non-interactive \
            --endpoint https://shilu-new.app.spacelift.io \
            --api-key-id ${{ secrets.SPACELIFT_API_KEY_ID }} \
            --api-key-secret ${{ secrets.SPACELIFT_API_KEY_SECRET }}
      
          spacectl stack run --id new-demo \
            --message "Triggered from GitHub Actions on ${{ github.sha }}"
